<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>使用本地存储实现永久更换图像的功能</title>
    <style>
        img {
            width: 300px;
            height: 200px;
        }
    </style>
</head>
<body>
    <img id="img" src="default.jpg"> <!-- 默认图片 -->
    <input id="file" type="file" accept="image/*"> <!-- 选择图片的按钮 -->
    <script>
        // 获取图片对象和文件对象
        var img = document.getElementById("img");
        var file = document.getElementById("file");

        // 定义一个函数，用于将图片转换为base64编码的字符串
        function getBase64Image(img) {
            var canvas = document.createElement("canvas");
            canvas.width = img.width;
            canvas.height = img.height;
            var ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, img.width, img.height);
            var dataURL = canvas.toDataURL("image/png");
            return dataURL;
        }

        // 定义一个函数，用于将base64编码的字符串转换为图片
        function base64ToImage(base64) {
            var image = new Image();
            image.src = base64;
            return image;
        }

        // 定义一个函数，用于从本地存储中读取图片链接，并设置给图片对象
        function loadImage() {
            var imageSrc = localStorage.getItem("imageSrc"); // 从本地存储中获取图片链接
            if (imageSrc) { // 如果存在图片链接
                var image = base64ToImage(imageSrc); // 将图片链接转换为图片对象
                img.src = image.src; // 设置图片对象的src属性为图片链接
            }
        }

        // 定义一个函数，用于将图片链接保存到本地存储中
        function saveImage() {
            var imageSrc = getBase64Image(img); // 将图片对象转换为图片链接
            localStorage.setItem("imageSrc", imageSrc); // 将图片链接保存到本地存储中
        }

        // 为文件对象绑定onchange事件，当用户选择了图片时触发
        file.onchange = function() {
            var reader = new FileReader(); // 创建一个文件读取器对象
            reader.readAsDataURL(file.files[0]); // 读取用户选择的文件
            reader.onload = function(e) { // 当文件读取完成时触发
                img.src = e.target.result; // 设置图片对象的src属性为文件的内容
                saveImage(); // 调用保存图片的函数
            }
        }

        // 调用加载图片的函数
        loadImage();
    </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>和风天气示例</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        #container {
            width: 300px;
            height: 200px;
            margin: 0 auto;
            border: 1px solid black;
            text-align: center;
        }

        #city {
            font-size: 24px;
            font-weight: bold;
            margin-top: 20px;
        }

        #temp {
            font-size: 36px;
            color: blue;
            margin-top: 20px;
        }

        #text {
            font-size: 18px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="city"></div>
        <div id="temp"></div>
        <div id="text"></div>
    </div>
    <div class="qweather-list__row visible-740">
        <div class="c-img-map">
                <img src="https://imagery.qweather.net/imagery/tmp/2023/12/28/18/au.jpg">
            <div class="img-map__title">
                <h3 class="qweather-title">温度</h3>
            </div>
            <div class="img-map__btn">
                <a href="https://map.qweather.com" target="_blank" rel="noopener noreferrer">
                    <div class="img"></div>
                    <span>查看完整天气地图</span>
                </a>
            </div>
        </div>     
    <script>
        // 你的key，需要替换成你自己的
        var key = "d290f13b29404c43a83f2fa2031330c9";

        // 获取当前地理位置的经纬度
        navigator.geolocation.getCurrentPosition(function(position) {
            var lat = position.coords.latitude;
            var lon = position.coords.longitude;

            // 调用GeoApi，获取当前地区的城市id
            $.ajax({
                url: "https://geoapi.qweather.com/v2/city/lookup",
                data: {
                    key: key,
                    location: lon + "," + lat
                },
                dataType: "json",
                success: function(data) {
                    if (data.code == "200") {
                        // 取第一个城市信息
                        var city = data.location[0];
                        var name = city.name; // 城市名称
                        var id = city.id; // 城市id

                        // 显示城市名称
                        $("#city").text(name);

                        // 调用城市天气预报API，获取当前城市的实时天气
                        $.ajax({
                            url: "https://devapi.qweather.com/v7/weather/now",
                            data: {
                                key: key,
                                location: id
                            },
                            dataType: "json",
                            success: function(data) {
                                if (data.code == "200") {
                                    // 取实时天气信息
                                    var now = data.now;
                                    var temp = now.temp; // 温度
                                    var text = now.text; // 天气状况

                                    // 显示温度和天气状况
                                    $("#temp").text(temp + "℃");
                                    $("#text").text(text);
                                } else {
                                    // 处理错误情况
                                    alert("获取实时天气失败，错误码：" + data.code);
                                }
                            }
                        });
                    } else {
                        // 处理错误情况
                        alert("获取城市信息失败，错误码：" + data.code);
                    }
                }
            });
        });
    </script>
</body>
</html>

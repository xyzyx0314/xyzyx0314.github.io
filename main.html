<!-- main.html -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>主页面</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <script src="main.js"></script>
  <script src="index.js"></script>
  <script src="weather.js"></script>


  <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css" />

  <link href="main.css" rel="stylesheet">
  <link href="map.css" rel="stylesheet">
  <link href="weather.css" rel="stylesheet">
  <link href="history.css" rel="stylesheet">
  <link href="setting.css" rel="stylesheet">
  <script src="qrcode.min.js"></script>

  
  

  <script> 
    window._AMapSecurityConfig = {
      securityJsCode: '6c569d1bdc12c850627523a56f4c3b3e',
    }
  </script>
      <script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script>
      <script type="text/javascript" src="https://webapi.amap.com/maps?v=2.0&key=b556f62b89a6b24871453d90532cbc16&plugin=AMap.Geocoder"></script>
      
</head>
<body>


  
  <!-- 地图所需代码 -->
  <div class="map-map" id='map-map' style="display: none;"></div>
  <div class="info map-map" style="display: none;">
      <h4 id='status'></h4><hr>
      <p id='result'></p><hr>
  </div>
  <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=b556f62b89a6b24871453d90532cbc16"></script>
  <script type="text/javascript">
      var map = new AMap.Map('map-map', {
          resizeEnable: true,
      });
      AMap.plugin('AMap.Geolocation', function() {
        var geolocation = new AMap.Geolocation({
          enableHighAccuracy: true,//是否使用高精度定位，默认:true
          timeout: 10000,          //超过10秒后停止定位，默认：5s
          buttonPosition:'RB',    //定位按钮的停靠位置
          buttonOffset: new AMap.Pixel(10, 20),//定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
          zoomToAccuracy: true,   //定位成功后是否自动调整地图视野到定位点
        });
        map.addControl(geolocation);
        geolocation.getCurrentPosition(function(status,result){
          if(status=='complete'){
            onComplete(result)
          }else{
            onError(result)
            }
          });
      });
      //解析定位结果
      function onComplete(data) {
        document.getElementById('status').innerHTML='定位成功'
        var str = [];
        str.push('定位结果：' + data.position);
        str.push('定位类别：' + data.location_type);


        // 更改地图定位
        // 获取 src 属性的值
        var src = $("#map-mapset").attr("src");
        // 使用正则表达式匹配经纬度
        var regex = /dest=(\d+\.\d+),(\d+\.\d+)/;
        // 使用 replace 方法替换经纬度为 data.position 的内容
        var newSrc = src.replace(regex, "dest=" + data.position);
        // 设置新的 src 属性的值
        $("#map-mapset").attr("src", newSrc);
        // alert(data.position);

        // if(data.accuracy){
          // str.push('精度：' + data.accuracy + ' 米');
        // }//如为IP精确定位结果则没有精度信息
        // str.push('是否经过偏移：' + (data.isConverted ? '是' : '否'));
        // document.getElementById('result').innerHTML = str.join('<br>');
      }
      //解析定位错误信息
      function onError(data) {
          document.getElementById('status').innerHTML='定位失败'
          document.getElementById('result').innerHTML = '失败原因排查信息:'+data.message;
      }
      function changemapcity(pos) {
        // alert("new"+pos);        
        document.getElementById('status').innerHTML='定位成功'
        var str = [];
        str.push('定位结果：' + pos);
        // 更改地图定位
        // 获取 src 属性的值
        var src = $("#map-mapset").attr("src");
        // 使用正则表达式匹配经纬度
        var regex = /dest=(\d+\.\d+),(\d+\.\d+)/;
        // 使用 replace 方法替换经纬度为 data.position 的内容
        var newSrc = src.replace(regex, "dest=" + pos);
        // 设置新的 src 属性的值
        $("#map-mapset").attr("src", newSrc);
        // alert();
      }
  </script>
  
  
  <iframe style="display: none;" id="map-mapset" class="map-mapset" src="https://m.amap.com/navi/?dest=116.470098,39.992838&destName=默认城市&hideRouteIcon=1&key=b556f62b89a6b24871453d90532cbc16" frameborder="0"></iframe>

  <!-- 天气所需代码 -->
  <div class="weather-weatherset" id="weather-weatherset" style="display: none;">
    <div class="weatherset-top">
      <div class="weather-top-button" onclick="loadweathertoday()">
        <h1></h1>
        <img src="img/today.svg">
      </div>
      <div class="weather-top-button" onclick="loadweatherbing()">
        <h1></h1>
        <img src="img/bing.svg">
      </div>
    </div>
    <div class="weather-today" id="weather-today" style="display: block;">
      <div class="weather-today-city" id="weather-today-city">余杭区</div>
      <div class="weather-today-temp" id="weather-today-temp">10°C</div>
      <div class="weather-today-today" id="weather-today-today">晴3-10°C</div>
      <div class="weather-today-mess" id="weather-today-mess1">风向：西</div>
      <div class="weather-today-mess" id="weather-today-mess2">风力：≤3 级</div>
      <div class="weather-today-mess" id="weather-today-mess3">空气湿度：30</div>
      
      <div class="weather-today-future" id="weather-today-future">预报天气</div>
      <div class="weather-today-weather" id="weather-today-weather1">2024-01-05 晴 -4~5℃</div>
      <div class="weather-today-weather" id="weather-today-weather2">2024-01-06 晴 -12~2℃</div>
      <div class="weather-today-weather" id="weather-today-weather3">2024-01-07 晴 -9~0℃</div>
      <div class="weather-today-weather" id="weather-today-weather4">2024-01-08 多云 -6~2℃</div>


    </div>    
    <div class="weather-bing" id="weather-bing" style="display: none;">    
      <div class="weather-QRcode">
        <h1>二维码生成器</h1>
        <p>请输入一个网址，点击生成按钮，即可在下方看到网址的二维码。</p>
        <input type="text" id="url" placeholder="www.hznu.edu.cn" style="width: 300px;">
        <button id="generate" onclick="loadQRcode()">生成3</button>
        <div class="qrcode" id="qrcode"></div>
      </div>      
      <div class="weather-bing-title" onclick="loadbing()">点击获得 Bing 每日一图</div>
      <div class="weather-bing-picture">
        <img id="Bingpicture" src="https://api.xygeng.cn/bing/view" alt="" style="display: none;">
      </div>
    </div>
  </div>


  <!-- 历史所需代码 -->

  
  <!-- 设置所需代码 -->

  <div class="setting-settingset" id="setting-settingset" style="display: none;">
    <div class="setting-person setting-container">
      <div class="setting-person-picture">
        <div class="setting-person-font">心晴头像</div>
        <img id="img" src="wea/wea (1).svg" alt="图片">
        <button class="setting-person-button" id="next">换一个</button>
      </div>
    </div>
    <div class="setting-password setting-container" onclick="settingpassword()"> 修改密码 </div>   
    <div class="setting-changecity setting-container" onclick="settingchangecity()"> 切换城市 </div>
    
    
    <div class="setting-addcity setting-container" onclick="settingaddcity()"> 增加城市 </div>    
    <div class="setting-load setting-container" onclick="settingload()"> 自动登录 </div>    
    <div class="setting-container2 copyright colorfulword">Copyright © CKZ</div>
  </div>


  <!-- 设置子页面 -->
  <div class="setting-page setting-page-password" style="display: none;" id="setting-page1">
    <div class="setting-page-title">修改密码</div>
    <div class="setting-page-button">
      <div class="setting-page-enter" onclick="setPageEnter()"> 确认 </div>
      <div class="setting-page-close" onclick="setPageClose()"> 关闭 </div>
    </div>
  </div>


  <input id="tmptmptmp" style="display: none;">
  <!-- 改默认城市 -->
  <div id="changecity-map" style="display: none;" ></div>
  <script>
    var map2 = new AMap.Map('changecity-map', {
      resizeEnable: true,
      center: [120.01809,30.292206],
      zoom: 12
    });
    //为地图注册click事件获取鼠标点击出的经纬度坐标
    map2.on('click', function(e) {
      changemapcity(e.lnglat);
      
      document.getElementById('tmptmptmp').value = e.lnglat;

      var lnglat  = document.getElementById('tmptmptmp').value.split(',');
      getcity();
        // alert("@@"+lnglat);
      // map2.setCenter(e.lnglat);
      // alert(e.lnglat);
      //获取地图的中心点对象
      var center = map2.getCenter();
      //将中心点对象转换为字符串
      var centerStr = center.toString();
      //用alert弹出框显示中心点坐标
      // alert(centerStr);
      AMap.plugin('AMap.Weather', function() {
        var weather = new AMap.Weather();
        //查询实时天气信息, 查询的城市到行政级别的城市，如朝阳区、杭州市
        weather.getLive('朝阳区', function(err, data) {
            if (!err) {
                // alert(data.temperature);
                // var str = [];
                // str.push('<h4 >实时天气' + '</h4><hr>');
                // str.push('<p>城市/区：' + data.city + '</p>');
                // str.push('<p>天气：' + data.weather + '</p>');
                // str.push('<p>温度：' + data.temperature + '℃</p>');
                // str.push('<p>风向：' + data.windDirection + '</p>');
                // str.push('<p>风力：' + data.windPower + ' 级</p>');
                // str.push('<p>空气湿度：' + data.humidity + '</p>');
                // str.push('<p>发布时间：' + data.reportTime + '</p>');
                // var marker = new AMap.Marker({map: map, position: map.getCenter()});
                // var infoWin = new AMap.InfoWindow({
                //     content: '<div class="info" style="position:inherit;margin-bottom:0;">'+str.join('')+'</div><div class="sharp"></div>',
                //     isCustom:true,
                //     offset: new AMap.Pixel(0, -37)
                // });
                // infoWin.open(map, marker.getPosition());
                // marker.on('mouseover', function() {
                //     infoWin.open(map, marker.getPosition());
                // });
            }
        });

    //     //未来4天天气预报
    //     weather.getForecast('朝阳区', function(err, data) {
    //         if (err) {return;}
    //         var str = [];
    //         for (var i = 0,dayWeather; i < data.forecasts.length; i++) {
    //             dayWeather = data.forecasts[i];
    //             str.push(dayWeather.date+' <span class="weather">'+dayWeather.dayWeather+'</span> '+ dayWeather.nightTemp + '~' + dayWeather.dayTemp + '℃');
    //         }
    //         document.getElementById('forecast').innerHTML = str.join('<br>');
    //     });
    });
    });

  </script>  
  <div class="changecity-map-close" id="changecity-map-close" onclick="closeChangeCity()" style="display: none;"> 关闭1 </div>




  <div class="setting-page setting-page-changecity" style="display: none;" id="setting-page2">
    <div class="setting-page-title">切换城市</div>
    <div class="setting-page-button">
      <div class="setting-page-enter" onclick="setPageEnter()"> 确认 </div>
      <div class="setting-page-close" onclick="setPageClose()"> 关闭 </div>
    </div>
  </div>






  <!-- <div class="setting-page setting-page-addcity" style="display: none;" id="setting-page3">
    <div class="setting-page-title">增加城市</div>

    <div class="setting-page-button">
      <div class="setting-page-enter" onclick="setPageEnter()"> 确认 </div>
      <div class="setting-page-close" onclick="setPageClose()"> 关闭 </div>
    </div>
  </div>

  <div class="setting-page setting-page-load" style="display: none;" id="setting-page4">
    <div class="setting-page-title">自动登录</div>

    <div class="setting-page-button">
      <div class="setting-page-enter" onclick="setPageEnter()"> 确认 </div>
      <div class="setting-page-close" onclick="setPageClose()"> 关闭 </div>
    </div>
  </div> -->








  <script>
    // 获取图片元素
    var img = document.getElementById("img");
    // 获取按钮元素
    var prev = document.getElementById("prev");
    var next = document.getElementById("next");
    // 定义一个变量，表示当前图片的索引
    var index = 1;
    // 定义一个函数，根据索引更新图片的src属性
    function updateImg() {
      img.src = "wea/wea (" + index + ").svg";
    }
    // 给下一张按钮添加点击事件
    next.onclick = function() {
      // 索引加一
      index++;
      // 如果索引大于28，就设置为1
      if (index > 28) {
        index = 1;
      }
      // 更新图片
      updateImg();
    }
  </script>






  <div class="container">
    <div class="md-md">
      <!-- 这里放置地图的内容 -->
      <div class="md-md-map" id="map" style="display: none;">
      </div>

      <!-- 这里放置天气的内容 -->
      <div class="md-md-weather" id="weather" style="display: none;">
            
        <div>weather</div>
      </div>

      <!-- 这里放置历史的内容 -->
      <div class="md-md-history" id="history" style="display: none;">
              
        <div>history</div>
      </div>

      <!-- 这里放置设置的内容 -->
      <div class="md-md-setting" id="setting" style="display: none;">
    
        <!-- <div>setting</div> -->
      </div>       
    </div>

    <!-- 下方四按钮 -->
    <div class="md-bt">
      <div class="md-bt-button md-bt-map" onclick="loadmap()">
        <h1></h1>
        <img src="img/map1.svg">
      </div>
      <div class="md-bt-button md-bt-weather" onclick="loadweather()">
        <h1></h1>
        <img src="img/weather1.svg">
      </div>
      <div class="md-bt-button md-bt-history" onclick="loadhistory()">
        <h1></h1>
        <img src="img/history1.svg">
      </div>
      <div class="md-bt-button md-bt-setting" onclick="loadsetting()">
        <h1></h1>
        <img src="img/setting1.svg">
        





        
    </div>
  </div>
</body>
<!-- 修改默认城市中获得改城市的具体位置，经纬度逆推 -->
<script>
  function getcity() {
    var geocoder = new AMap.Geocoder({
        city: "010", //城市设为北京，默认：“全国”
        radius: 1000 //范围，默认：500
    });
    var marker = new AMap.Marker();;
    var lnglat  = document.getElementById('tmptmptmp').value.split(',');
    map.add(marker);
    marker.setPosition(lnglat);
    geocoder.getAddress(lnglat, function(status, result) {
      if (status === 'complete'&&result.regeocode) {
        var address = result.regeocode.formattedAddress;
        alert("当前默认地点为："+address);
        weatherchange(address[3]+address[4]+address[5]);
      }else{
        log.error('根据经纬度查询地址失败')
      }
    });
  }
</script>
</html>
